<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🧪 DPI & Resolution Compatibility Test</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f0f8ff; 
            line-height: 1.6;
        }
        .test-section { 
            background: white; 
            border: 2px solid #4a90e2; 
            padding: 20px; 
            margin: 15px 0; 
            border-radius: 8px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .critical { border-color: #e53e3e; background: #fef5e7; }
        .success { border-color: #38a169; background: #f0fff4; }
        .info { border-color: #3182ce; background: #ebf8ff; }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .metric {
            background: #f7fafc;
            padding: 12px;
            border-radius: 6px;
            border-left: 4px solid #4a90e2;
        }
        
        .metric-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #2d3748;
        }
        
        .metric-label {
            font-size: 0.9em;
            color: #718096;
            margin-top: 4px;
        }
        
        button {
            background: #4a90e2;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 1em;
        }
        
        button:hover {
            background: #3182ce;
        }
        
        .log {
            background: #1a202c;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .wheel-preview {
            width: 200px;
            height: 200px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            margin: 10px auto;
            position: relative;
            background: white;
        }
        
        @media (hover: none) and (pointer: coarse) {
            .touch-indicator {
                background: #38a169;
                color: white;
                padding: 8px;
                border-radius: 4px;
                margin: 10px 0;
            }
        }
    </style>
</head>
<body>
    <h1>🧪 DPI & Resolution Compatibility Test Suite</h1>
    <p><strong>Testing the Feelings Wheel for cross-device compatibility</strong></p>
    
    <div class="test-section info">
        <h3>📊 Device Information</h3>
        <div class="test-grid" id="device-info">
            <!-- Populated by JavaScript -->
        </div>
        <div class="touch-indicator" style="display: none;">
            ✅ Touch Device Detected - Testing touch targets
        </div>
    </div>
    
    <div class="test-section">
        <h3>🎯 DPI Compatibility Tests</h3>
        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            <button onclick="testDpiAwareness()">🔍 Test DPI Awareness</button>
            <button onclick="testTouchTargets()">👆 Test Touch Targets</button>
            <button onclick="testResponsivePanel()">📱 Test Responsive Panel</button>
            <button onclick="testFontScaling()">🔤 Test Font Scaling</button>
            <button onclick="runFullTest()">🚀 Run All Tests</button>
            <button onclick="clearLog()">🧹 Clear Log</button>
        </div>
    </div>
    
    <div class="test-section">
        <h3>📱 Responsive Panel Preview</h3>
        <div style="display: flex; gap: 20px; align-items: center; flex-wrap: wrap;">
            <div style="flex: 1; min-width: 200px;">
                <p><strong>Panel Width:</strong> <span id="panel-width-display">Loading...</span></p>
                <p><strong>CSS Custom Property:</strong> <code>var(--panel-width)</code></p>
                <div style="width: var(--panel-width, 300px); height: 60px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
                    Responsive Panel
                </div>
            </div>
        </div>
    </div>
    
    <div class="test-section">
        <h3>🎨 Touch Target Test Area</h3>
        <p>Minimum size: <strong>44px × 44px</strong> (WCAG Guidelines)</p>
        <div style="display: flex; gap: 10px; flex-wrap: wrap; margin: 15px 0;">
            <div style="width: var(--touch-target-min, 44px); height: var(--touch-target-min, 44px); background: #38a169; border-radius: 6px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; cursor: pointer;" onclick="logTouch('Good')">✓</div>
            <div style="width: 32px; height: 32px; background: #e53e3e; border-radius: 6px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; cursor: pointer;" onclick="logTouch('Too Small')">✗</div>
            <div style="width: calc(var(--touch-target-min, 44px) * 1.2); height: calc(var(--touch-target-min, 44px) * 1.2); background: #3182ce; border-radius: 6px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; cursor: pointer;" onclick="logTouch('Excellent')">★</div>
        </div>
    </div>
    
    <div class="test-section">
        <h3>📋 Test Results</h3>
        <div class="log" id="test-log">Click "Run All Tests" to begin compatibility testing...</div>
    </div>

    <script>
        let testResults = {};
        
        function log(message, type = 'info') {
            const output = document.getElementById('test-log');
            const timestamp = new Date().toLocaleTimeString();
            const logLine = `[${timestamp}] ${message}\n`;
            output.innerHTML += logLine;
            output.scrollTop = output.scrollHeight;
            console.log(message);
        }
        
        function clearLog() {
            document.getElementById('test-log').innerHTML = '';
            testResults = {};
        }
        
        function logTouch(target) {
            log(`👆 Touch test: ${target} target tapped`);
        }
        
        function displayDeviceInfo() {
            const dpr = window.devicePixelRatio || 1;
            const isTouch = window.navigator.maxTouchPoints > 0;
            const isMobile = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            const info = [
                { label: 'Device Pixel Ratio', value: dpr + 'x' },
                { label: 'Screen Resolution', value: `${screen.width}×${screen.height}` },
                { label: 'Viewport Size', value: `${window.innerWidth}×${window.innerHeight}` },
                { label: 'Touch Support', value: isTouch ? 'Yes' : 'No' },
                { label: 'Mobile Device', value: isMobile ? 'Yes' : 'No' },
                { label: 'User Agent', value: navigator.userAgent.split(' ')[0] }
            ];
            
            const container = document.getElementById('device-info');
            container.innerHTML = info.map(item => `
                <div class="metric">
                    <div class="metric-value">${item.value}</div>
                    <div class="metric-label">${item.label}</div>
                </div>
            `).join('');
            
            // Show touch indicator if touch device
            if (isTouch) {
                document.querySelector('.touch-indicator').style.display = 'block';
            }
        }
        
        function updatePanelWidth() {
            const panelWidth = getComputedStyle(document.documentElement).getPropertyValue('--panel-width');
            document.getElementById('panel-width-display').textContent = panelWidth || 'Not set';
        }
        
        function testDpiAwareness() {
            log('🔍 Testing DPI Awareness...');
            
            const dpr = window.devicePixelRatio || 1;
            const baseFont = getComputedStyle(document.documentElement).getPropertyValue('--base-font-size');
            const fontScale = getComputedStyle(document.documentElement).getPropertyValue('--font-scale');
            
            log(`   Device Pixel Ratio: ${dpr}`);
            log(`   Base Font Size: ${baseFont}`);
            log(`   Font Scale Factor: ${fontScale}`);
            
            if (dpr > 1) {
                log(`   ✅ High DPI display detected, scaling should be active`);
                testResults.dpi = 'PASS';
            } else {
                log(`   ℹ️ Standard DPI display, baseline scaling`);
                testResults.dpi = 'BASELINE';
            }
        }
        
        function testTouchTargets() {
            log('👆 Testing Touch Target Sizes...');
            
            const minSize = getComputedStyle(document.documentElement).getPropertyValue('--touch-target-min');
            log(`   Minimum touch target size: ${minSize}`);
            
            const targets = document.querySelectorAll('[style*="var(--touch-target-min"]');
            let passCount = 0;
            
            targets.forEach((target, i) => {
                const rect = target.getBoundingClientRect();
                const size = Math.min(rect.width, rect.height);
                if (size >= 44) {
                    passCount++;
                    log(`   ✅ Target ${i+1}: ${size.toFixed(1)}px (PASS)`);
                } else {
                    log(`   ❌ Target ${i+1}: ${size.toFixed(1)}px (FAIL - too small)`);
                }
            });
            
            testResults.touchTargets = passCount === targets.length ? 'PASS' : 'FAIL';
            log(`   Result: ${passCount}/${targets.length} targets pass WCAG guidelines`);
        }
        
        function testResponsivePanel() {
            log('📱 Testing Responsive Panel System...');
            
            const panelWidth = getComputedStyle(document.documentElement).getPropertyValue('--panel-width');
            const viewportWidth = window.innerWidth;
            
            log(`   Panel width: ${panelWidth}`);
            log(`   Viewport width: ${viewportWidth}px`);
            
            // Test if panel scales appropriately
            const panelPx = parseFloat(panelWidth);
            const ratio = panelPx / viewportWidth;
            
            if (ratio > 0.1 && ratio < 0.4) {
                log(`   ✅ Panel scaling appropriate: ${(ratio * 100).toFixed(1)}% of viewport`);
                testResults.responsive = 'PASS';
            } else {
                log(`   ⚠️ Panel scaling may be problematic: ${(ratio * 100).toFixed(1)}% of viewport`);
                testResults.responsive = 'WARNING';
            }
        }
        
        function testFontScaling() {
            log('🔤 Testing Font Scaling System...');
            
            const baseFont = getComputedStyle(document.documentElement).getPropertyValue('--base-font-size');
            const fontScale = getComputedStyle(document.documentElement).getPropertyValue('--font-scale');
            const bodyFont = getComputedStyle(document.body).fontSize;
            
            log(`   Base font: ${baseFont}`);
            log(`   Font scale: ${fontScale}`);
            log(`   Computed body font: ${bodyFont}`);
            
            const basePx = parseFloat(baseFont);
            const scaleFactor = parseFloat(fontScale) || 1;
            const expectedSize = basePx * scaleFactor;
            const actualSize = parseFloat(bodyFont);
            
            if (Math.abs(expectedSize - actualSize) < 2) {
                log(`   ✅ Font scaling working correctly`);
                testResults.fontScaling = 'PASS';
            } else {
                log(`   ❌ Font scaling mismatch: expected ${expectedSize}px, got ${actualSize}px`);
                testResults.fontScaling = 'FAIL';
            }
        }
        
        function runFullTest() {
            clearLog();
            log('🚀 Starting Full DPI Compatibility Test Suite...\n');
            
            testDpiAwareness();
            log('');
            testTouchTargets();
            log('');
            testResponsivePanel();
            log('');
            testFontScaling();
            log('');
            
            // Summary
            const results = Object.values(testResults);
            const passCount = results.filter(r => r === 'PASS').length;
            const totalTests = results.length;
            
            log('📊 TEST SUMMARY:');
            log(`   Total Tests: ${totalTests}`);
            log(`   Passed: ${passCount}`);
            log(`   Warnings: ${results.filter(r => r === 'WARNING').length}`);
            log(`   Failed: ${results.filter(r => r === 'FAIL').length}`);
            
            if (passCount === totalTests) {
                log('\n🎉 ALL TESTS PASSED! The app is DPI/resolution compatible.');
            } else if (passCount >= totalTests * 0.75) {
                log('\n⚠️ Most tests passed. Minor issues detected but app should work well.');
            } else {
                log('\n❌ Critical issues detected. App may not work properly on some devices.');
            }
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            displayDeviceInfo();
            updatePanelWidth();
            
            // Auto-run basic tests after a moment
            setTimeout(() => {
                log('🔧 Auto-detecting device capabilities...\n');
                testDpiAwareness();
            }, 500);
        });
        
        // Update on resize
        window.addEventListener('resize', () => {
            setTimeout(() => {
                displayDeviceInfo();
                updatePanelWidth();
            }, 100);
        });
    </script>
</body>
</html> 